# PrioritySchedule

Library to help manage patient call lists.

## Installation

`npm install @rwlaschin/priority-scheduler`

## Usage

    The exmaple below shows how to load and initialize the priority scheduler.

    var PriorityScheduler = require('@rwlaschin/priority-scheduler');

    // initialize the patient database
    PriorityScheduler.load();

    // get a list of patients to call
    PriorityScheduler.get(location, 10);

Output should be an array of patient data

## Tests

`npm test`

## Running

For testing and examples there is a web server that runs on part 8080

`npm start`

There are two routes

/dump?&storage=[patients|trees]

/available?&location=[lat,long]&count=[\d+]&format=[json|csv|html]

## Data

- Patient
    {
    id - String - Uniquely Represents User
    name - String - User First and Last name
    location: {
    latitude - Float - Latitude Geo Position
    longitude - Float - Longitude Geo Position
    },
    age - Number - Age of patient in years
    acceptedOffers - Number - Count of accepted appointments
    canceledOffers - Number - Count of canceled appointments
    averageReplyTime - Number - Average response time value in seconds, based length of time to return appointment request
    }

## API

Before all examples require the module

`var PriorityScheduler = require('@rwlaschin/priority-scheduler');`

- Static Functions

    `PriorityScheduler.load()`

    Loads and initializes patient database.

    `PriorityScheduler.get(location, count)`

    Retrieves a set of patients based on location up to count spefied

    `PriorityScheduler.updateByName(name,info)`

    Update patient information based on name, will not update if there are multiple users with the same name. Data is applied to existing information, so only partial information/fields are necessary.

    `PriorityScheduler.updateById(id, info)`

    Update patient information based on id. Data is applied to existing information, so only partial information/fields are necessary.

## Algorithim

    Each patient is given a numerical identifier between 1 and 10.  This number is generated by the summation of weights calculated from the existing users data, a set of reasonable defaults and the target or desired location.  These values are used to fill out 30 RandomForests.  A small fuzz value is applied to the set defaults when initializing each RandomTree this provides a variety of ordering when constructing the Trees.  When a request is made for the list of users, each RandomTree is searched for a patient with a high match rating.  Once a match is found the tree is traversed collecting all of the nearby users.  The results are placed in a priority queue with the highest priorities sorting to the beginning of the list.  After all of the trees have been search and a large enough sample has been collected the duplicates are removed, the list is reduced to the desired size, formatted and sent back to the user.

- Defaults
    maxDistance -
    desiredAge -
    minActivity -
    desiredReplyTime -

- Calculations
    Demographics
        Distance - scaleValue / scaleValue + Math.max( 0, (requestedLocation - patientLocation) - maxRadius)^2
        Age

    Behavioral
        AcceptedOffers
        CanceledOffers
        ReplayTime


## Contributing

In lieu of a formal style guide, take care to maintain the existing coding style. Add unit tests for any new or changed functionality. Lint and test your code.
